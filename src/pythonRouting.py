import numpy as np
import matplotlib.pyplot as plt
from matplotlib.widgets import Button

currentRoute = [[0.6390160322, -0.3888051882],
 [0.9395764470, -0.4098225012],
 [1.2399659750, -0.4331607744],
 [1.5402329560, -0.4580264762],
 [1.8404185180, -0.4838532712],
 [2.1405379770, -0.5104456386],
 [2.4405404330, -0.5383226688],
 [2.7403780220, -0.5679201726],
 [3.0400640960, -0.5990134887],
 [3.3396019940, -0.6315032989],
 [3.6389814620, -0.6654218659],
 [3.9381535050, -0.7011203319],
 [4.2378368380, -0.7321562916],
 [4.5383181570, -0.7541384548],
 [4.8393564220, -0.7662895694],
 [5.1406340600, -0.7685431913],
 [5.4417505260, -0.7591835782],
 [5.7409570220, -0.7251334488],
 [6.0310561660, -0.6453089267],
 [6.3031868930, -0.5166605599],
 [6.5530180930, -0.3486709855],
 [6.7816851140, -0.1526218355],
 [6.9893701080, 0.0654621869],
 [7.1721334460, 0.3048226533],
 [7.2601930579, 0.6103070662],
 [7.3319929906, 0.9099179387],
 [7.3744202236, 1.1809944423],
 [7.4103201899, 1.4378037616],
 [7.4070565566, 1.6946130808],
 [7.3907383901, 1.9514224001],
 [7.3417838905, 2.1796973505],
 [7.2830384911, 2.4650410386],
 [7.2406112581, 2.7218503578],
 [7.1753385920, 2.9358581238],
 [7.1329113590, 3.2640033651],
 [7.1002750260, 3.5778814220],
 [7.0578477930, 3.8204235568],
 [6.9991023935, 4.0915000605],
 [6.8848752279, 4.4909812237],
 [6.8228661951, 4.7477905430],
 [6.7021117628, 5.1330045218],
 [6.5976754971, 5.4183482099],
 [6.4475483650, 5.6751575291],
 [6.3469219210, 5.8772900100],
 [6.0834980010, 6.0228071210],
 [5.8016989230, 6.1290423870],
 [5.5091700550, 6.1992075440],
 [5.2125873570, 6.2522804740],
 [4.9165189270, 6.3081531520],
 [4.6208844180, 6.3662753110],
 [4.3249824050, 6.4228734970],
 [4.0251020190, 6.4497854710],
 [3.7238985300, 6.4571914670],
 [3.4227064850, 6.4650716780],
 [3.1215300560, 6.4735085960],
 [2.8202993870, 6.4793920520],
 [2.5224961040, 6.4446110730],
 [2.2512470480, 6.3151879310],
 [2.0218479630, 6.1211490630],
 [1.8532875180, 5.8724811080],
 [1.7587215300, 5.5872590540],
 [1.7373310330, 5.2873375420],
 [1.7734660510, 4.9884648320],
 [1.8635739680, 4.7016055580],
 [2.0238970520, 4.4476544860],
 [2.2594804760, 4.2628860470],
 [2.5345629450, 4.1403329370],
 [2.8159474130, 4.0326304440],
 [3.1000210050, 3.9323034290],
 [3.3680824346, 3.7874515609],
 [3.5121928125, 3.6284405347],
 [3.6313610096, 3.3481844891],
 [3.6757026643, 3.1139930971],
 [3.6701599575, 2.8520925834],
 [3.6507604836, 2.5808384800],
 [3.5620771741, 2.3469987356],
 [3.4207381496, 2.1786341197],
 [3.2461428841, 1.9915623242],
 [2.9773216023, 1.8325512980],
 [2.7611560355, 1.7016010412],
 [2.5006488139, 1.5800043741],
 [2.1841405630, 1.5076114540],
 [1.8829830290, 1.5156942610],
 [1.5822384950, 1.5338554380],
 [1.2817260030, 1.5555279850],
 [0.9819203615, 1.5853259560],
 [0.6832224429, 1.6247085330],
 [0.3861871511, 1.6749175190],
 [0.0935253967, 1.7464720610],
 [-0.1979903262, 1.8226094840],
 [-0.4892300367, 1.8997980360],
 [-0.7803969979, 1.9772610070],
 [-1.0439641889, 2.1707596100],
 [-1.2127424500, 2.3291852119],
 [-1.3038827110, 2.5844264594],
 [-1.3578917546, 2.8484691292],
 [-1.3713940155, 3.0949089543],
 [-1.3680184503, 3.3501502018],
 [-1.3140094067, 3.6053914492],
 [-1.2566247979, 3.8254270074],
 [-1.1722356673, 4.1158739442],
 [-1.1182266238, 4.4063208810],
 [-1.0473397541, 4.6703635507],
 [-1.0270863628, 4.9520090652],
 [-1.0574664498, 5.1632432010],
 [-1.1148510585, 5.3744773369],
 [-1.1924890587, 5.5153000941],
 [-1.2937560154, 5.6561228513],
 [-1.4220274938, 5.7705413415],
 [-1.6515659290, 5.9465697881],
 [-1.8777287989, 6.0521868560],
 [-2.1545251472, 6.1754067686],
 [-2.4096060049, 6.1890674313],
 [-2.6809069187, 6.1588452724],
 [-2.9603400230, 6.0550379750],
 [-3.2147995230, 5.8939909930],
 [-3.4476525780, 5.7029459480],
 [-3.6703069210, 5.4999685290],
 [-3.8907660250, 5.2946000100],
 [-4.1096841100, 5.0875937940],
 [-4.3215270040, 4.8733925820],
 [-4.5194165710, 4.6462674140],
 [-4.6986780170, 4.4042918680],
 [-4.8645560740, 4.1527891160],
 [-5.0402221680, 3.9080184700],
 [-5.2243890760, 3.6695744990],
 [-5.4121534820, 3.4339410070],
 [-5.6008498670, 3.1990535260],
 [-5.7899754050, 2.9645104410],
 [-5.9797279830, 2.7304755450],
 [-6.1688025000, 2.4958944320],
 [-6.3547556400, 2.2588295340],
 [-6.5394790170, 2.0208050010],
 [-6.7193169590, 1.7790875430],
 [-6.8808348180, 1.5249429940],
 [-7.0151886940, 1.2553635240],
 [-7.1267435550, 0.9755431414],
 [-7.2249119280, 0.6906972528],
 [-7.3179438110, 0.4041361436],
 [-7.4000256060, 0.1142564621],
 [-7.4702863690, -0.1787126958],
 [-7.5285396580, -0.4743033051],
 [-7.5740242000, -0.7721168101],
 [-7.6046581270, -1.0718204980],
 [-7.6203227040, -1.3726790550],
 [-7.6261441710, -1.6739135380],
 [-7.6183543210, -1.9750519990],
 [-7.5808866020, -2.2738358970],
 [-7.5031576160, -2.5646984580],
 [-7.3867528440, -2.8423910140],
 [-7.2365629670, -3.1033910510],
 [-7.0587096210, -3.3464570050],
 [-6.8577160840, -3.5705879930],
 [-6.6392490860, -3.7780315880],
 [-6.4383220670, -4.0024421220],
 [-6.2560505870, -4.2422900200],
 [-6.0814549920, -4.4878385070],
 [-5.9082319740, -4.7343590260],
 [-5.7370753290, -4.9823169710],
 [-5.5697119240, -5.2328433990],
 [-5.3867688824, -5.4346054293],
 [-5.0659370420, -5.5492088790],
 [-4.7796714310, -5.6430106160],
 [-4.4881885050, -5.7192256450],
 [-4.1939055920, -5.7838215830],
 [-3.8974604610, -5.8375103470],
 [-3.5986714360, -5.8761529920],
 [-3.2994860410, -5.9117310050],
 [-3.0008494850, -5.9516563420],
 [-2.7027695180, -5.9955480100],
 [-2.4052184820, -6.0428659920],
 [-2.1082239150, -6.0935869220],
 [-1.8109605310, -6.1427059170],
 [-1.5135149960, -6.1907179360],
 [-1.2160264850, -6.2384560110],
 [-0.9183708429, -6.2851445670],
 [-0.6204127669, -6.3298544880],
 [-0.3217318058, -6.3693914410],
 [-0.0222928617, -6.4027473930],
 [0.2776945904, -6.4307498930],
 [0.5781269968, -6.4534924030],
 [0.8789117932, -6.4709699150],
 [1.1800354720, -6.4805445670],
 [1.4808620210, -6.4674856660],
 [1.7776264550, -6.4159018990],
 [2.0659224390, -6.3296005730],
 [2.3311840300, -6.1878800390],
 [2.5519515280, -5.9846503730],
 [2.7388075590, -5.7486460210],
 [2.9763164520, -5.5644214150],
 [3.2560775280, -5.4549210070],
 [3.5377274750, -5.3483524320],
 [3.6938258571, -5.1137417801],
 [3.8911121669, -4.9319882074],
 [4.0497637324, -4.7735626055],
 [4.1138994716, -4.5799313143],
 [4.1476551238, -4.3774986008],
 [4.1645329500, -4.1222573534],
 [4.1341528629, -3.8582146836],
 [4.0632659933, -3.5765691691],
 [3.9349945148, -3.3477321886],
 [3.7425872971, -3.1364980528],
 [3.5096732967, -3.0044767179],
 [3.2768964770, -2.9203045370],
 [2.9764490130, -2.9069319960],
 [2.6768929960, -2.9387905600],
 [2.3780339960, -2.9770209790],
 [2.0788675550, -3.0127664800],
 [1.7792074680, -3.0440880060],
 [1.4792194960, -3.0721099380],
 [1.1791080240, -3.0987885000],
 [0.8789686859, -3.1251519920],
 [0.5788044035, -3.1512299780],
 [0.2785599455, -3.1763654950],
 [-0.0218999703, -3.1987534760],
 [-0.3227941990, -3.2139999870],
 [-0.6240110397, -3.2119524480],
 [-0.9241745472, -3.1869269610],
 [-1.2223140000, -3.1434589620],
 [-1.5215114950, -3.1080909970],
 [-1.8216240410, -3.0814670320],
 [-2.1221934560, -3.0606554750],
 [-2.4231890440, -3.0473445650],
 [-2.7240068910, -3.0307849650],
 [-3.0239039660, -3.0018954280],
 [-3.3233250380, -2.9683589940],
 [-3.6214369540, -2.9249175790],
 [-3.9139930010, -2.8537714480],
 [-4.1909160610, -2.7359324690],
 [-4.4521334170, -2.5861674550],
 [-4.6825356480, -2.3928830620],
 [-4.8605620860, -2.1506894830],
 [-4.9747030740, -1.8725205060],
 [-5.0214440820, -1.5754379630],
 [-5.0047860150, -1.2750655410],
 [-4.9285130500, -0.9841376543],
 [-4.7912733550, -0.7165324986],
 [-4.6039841180, -0.4809695594],
 [-4.3898916240, -0.2692406923],
 [-4.1416224240, -0.0995696634],
 [-3.8590434790, 0.0017392933],
 [-3.5586985350, 0.0024974346],
 [-3.2594250440, -0.0323317349],
 [-2.9597069030, -0.0630577952],
 [-2.6589800120, -0.0807456523],
 [-2.3577405210, -0.0863871425],
 [-2.0568159820, -0.1010902077],
 [-1.7563214900, -0.1230169535],
 [-1.4561759830, -0.1492923945],
 [-1.1563524600, -0.1790162176],
 [-0.8568378389, -0.2117164880],
 [-0.5575198382, -0.2461688966],
 [-0.2585319430, -0.2833745107],
 [0.0401924206, -0.3226474971],
 [0.3391333967, -0.3602218106],
 [0.6390160322, -0.3888051882]]

class DraggableScatter():

    epsilon = 5

    def __init__(self, scatter):

        self.scatter = scatter
        self._ind = None
        self.ax = scatter.axes
        self.canvas = self.ax.figure.canvas
        self.canvas.mpl_connect('button_press_event', self.button_press_callback)
        self.canvas.mpl_connect('button_release_event', self.button_release_callback)
        self.canvas.mpl_connect('motion_notify_event', self.motion_notify_callback)
        self.canvas.mpl_connect('key_press_event', self.on_key_press)
        plt.show()


    def get_ind_under_point(self, event):   
        xy = np.asarray(self.scatter.get_offsets())
        xyt = self.ax.transData.transform(xy)
        xt, yt = xyt[:, 0], xyt[:, 1]

        d = np.sqrt((xt - event.x)**2 + (yt - event.y)**2)
        ind = d.argmin()

        if d[ind] >= self.epsilon:
            ind = None

        return ind

    def button_press_callback(self, event):
        if event.inaxes is None:
            return
        if event.button != 1:
            return
        self._ind = self.get_ind_under_point(event)

    def button_release_callback(self, event):
        if event.button != 1:
            return
        self._ind = None

    def motion_notify_callback(self, event):
        if self._ind is None:
            return
        if event.inaxes is None:
            return
        if event.button != 1:
            return
        x, y = event.xdata, event.ydata
        xy = np.asarray(self.scatter.get_offsets())
        xy[self._ind] = np.array([x, y])        
        self.scatter.set_offsets(xy)
        self.canvas.draw_idle()
        # print(self.scatter.get_offsets())
		
    def on_key_press(self, event):
        if event.key == 'r':
            fileName = input('Enter name of file:')
            with open(fileName+'.txt', 'w') as f:
                f.writelines(np.array2string(self.scatter.get_offsets(), formatter={'float': lambda x: f'{x:.10f}'}, separator=', '))
                print("Waypoints Saved")
        elif event.key == 'd':
            ind = self.get_ind_under_point(event)
            if ind is not None:
                xy = np.asarray(self.scatter.get_offsets())
                xy = np.delete(xy, ind, axis=0)  
                self.scatter.set_offsets(xy)
                self.canvas.draw_idle()

# PLot
waypointsXInner =[]
waypointsYInner =[]

waypointsXCenter =[]
waypointsYCenter =[]

waypointsXOuter =[]
waypointsYOuter =[]

routeX =[]
routeY =[]
data = np.load('2022_march_pro.npy')
for points in data:
	for index, point in enumerate(points):
		if index == 0 :
			waypointsXCenter.append(point)
		elif index == 1 :
			waypointsYCenter.append(point)
		elif index == 2 :
			waypointsXInner.append(point)
		elif index == 3 :
			waypointsYInner.append(point)
		elif index == 4 :
			waypointsXOuter.append(point)
		elif index == 5 :
			waypointsYOuter.append(point)
			
for eachData in currentRoute:
	routeX.append(eachData[0])
	routeY.append(eachData[1])
	
fig, ax = plt.subplots()
scatter = ax.scatter(routeX, routeY, color = 'blue', s=11)
plt.plot(waypointsXInner,waypointsYInner, color ='black')
plt.plot(waypointsXCenter,waypointsYCenter, color='orange')
plt.plot(waypointsXOuter,waypointsYOuter, color ='black')

DraggableScatter(scatter)