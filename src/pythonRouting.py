import numpy as np
import matplotlib.pyplot as plt
from matplotlib.widgets import Button

currentRoute = [[0.7082675740, -0.4694416779],
 [0.9865249215, -0.4840248594],
 [1.2750185908, -0.4965201405],
 [1.5731002815, -0.5406551436],
 [1.8285988736, -0.5406551436],
 [2.1550692968, -0.5847901466],
 [2.4673453537, -0.6068576481],
 [2.7796214107, -0.6509926512],
 [3.0493143689, -0.6509926512],
 [3.3572775223, -0.7027725820],
 [3.6911863393, -0.7611053080],
 [4.0139648624, -0.7902716711],
 [4.3367433856, -0.8340212156],
 [4.6261310270, -0.8631875786],
 [4.9377792562, -0.8923539416],
 [5.1826457220, -0.8631875786],
 [5.4765509934, -0.8054651619],
 [5.7036608530, -0.6730601527],
 [5.9591594451, -0.4523851374],
 [6.1436862060, -0.2979126267],
 [6.3282129669, -0.1213726145],
 [6.4701566292, 0.0993024009],
 [6.6546833901, 0.2979099146],
 [6.8250157848, 0.5185849300],
 [6.9811538133, 0.8054624499],
 [7.0805143769, 1.0482049667],
 [7.1514862080, 1.2468124805],
 [7.1972289180, 1.4555382810],
 [7.2417500936, 1.6888691851],
 [7.2974015631, 1.9659496338],
 [7.3307924448, 2.2430300824],
 [7.3753136204, 2.5201105310],
 [7.3975742082, 2.8263573427],
 [7.4309650899, 3.1617705173],
 [7.4643559716, 3.4534341475],
 [7.4977468533, 3.7742641406],
 [7.4754862655, 4.0367614077],
 [7.4087045021, 4.3284250379],
 [7.2306197997, 4.6492550310],
 [7.0191442156, 4.9263354797],
 [6.8410595132, 5.1305000208],
 [6.6407142230, 5.3492477434],
 [6.3958477572, 5.5971618290],
 [6.2177630548, 5.7867431886],
 [5.9840268828, 5.9325750036],
 [5.7168998292, 6.0929900002],
 [5.4609030695, 6.1804890893],
 [5.2125873570, 6.2522804740],
 [4.9165189270, 6.3081531520],
 [4.6208844180, 6.3662753110],
 [4.3249824050, 6.4228734970],
 [4.0251020190, 6.4497854710],
 [3.7238985300, 6.4571914670],
 [3.3906684040, 6.4429863564],
 [3.1012807626, 6.4429863564],
 [2.8230234151, 6.4138199934],
 [2.6338084188, 6.3263209043],
 [2.4779843042, 6.2096554523],
 [2.3555510713, 6.0492404557],
 [2.2331178384, 5.8304927331],
 [2.1552057811, 5.5534122845],
 [2.1552057811, 5.2763318358],
 [2.1997269567, 4.9846682057],
 [2.2665087201, 4.7367541201],
 [2.4223328347, 4.5180063975],
 [2.5558963615, 4.3284250379],
 [2.7005901822, 4.1534268598],
 [2.8675445907, 4.0367614077],
 [3.0567595870, 3.8909295927],
 [3.2348442894, 3.7450977776],
 [3.3684078162, 3.5555164180],
 [3.4685804613, 3.3367686954],
 [3.5242319308, 3.0596882468],
 [3.5131016369, 2.7826077981],
 [3.4240592857, 2.5638600755],
 [3.3016260528, 2.3596955344],
 [3.1680625260, 2.2284469009],
 [3.0233687053, 2.0680319043],
 [2.8564142968, 1.9222000892],
 [2.6783295944, 1.7617850927],
 [2.4445934225, 1.6305364591],
 [2.1774663689, 1.5576205516],
 [1.8880787274, 1.5284541885],
 [1.5822384950, 1.5338554380],
 [1.2817260030, 1.5555279850],
 [0.9819203615, 1.5853259560],
 [0.6832224429, 1.6247085330],
 [0.3861871511, 1.6749175190],
 [0.0935253967, 1.7464720610],
 [-0.1979903262, 1.8226094840],
 [-0.4826738734, 1.8638673632],
 [-0.7803969979, 1.9772610070],
 [-1.0439641889, 2.1707596100],
 [-1.1616218013, 2.3596955344],
 [-1.2172732708, 2.6076096201],
 [-1.2395338586, 2.8992732502],
 [-1.2284035647, 3.1763536988],
 [-1.2172732708, 3.4242677844],
 [-1.1950126830, 3.6721818701],
 [-1.1616218013, 3.9055127742],
 [-1.1059703318, 4.1825932228],
 [-1.0614491562, 4.4305073084],
 [-1.0473397541, 4.6703635507],
 [-1.0270863628, 4.9520090652],
 [-1.0574664498, 5.1632432010],
 [-1.1148510585, 5.3744773369],
 [-1.1924890587, 5.5153000941],
 [-1.2937560154, 5.6561228513],
 [-1.4220274938, 5.7705413415],
 [-1.6515659290, 5.9465697881],
 [-1.8777287989, 6.0521868560],
 [-2.1545251472, 6.1754067686],
 [-2.4096060049, 6.1890674313],
 [-2.6809069187, 6.1588452724],
 [-2.9758597071, 6.1075731817],
 [-3.2207261729, 5.9471581852],
 [-3.4989835204, 5.8450759146],
 [-3.7327196923, 5.6846609180],
 [-3.9775861582, 5.4950795584],
 [-4.2335829179, 5.3200813804],
 [-4.4450585020, 5.1596663838],
 [-4.6787946739, 4.9846682057],
 [-4.8680096702, 4.8096700276],
 [-5.0572246665, 4.5763391235],
 [-5.3020911323, 4.2992586749],
 [-5.5469575981, 3.9638455002],
 [-5.6916514188, 3.6721818701],
 [-5.8808664152, 3.3076023324],
 [-5.9921693542, 3.0013555207],
 [-6.1034722932, 2.7096918906],
 [-6.2036449383, 2.4326114420],
 [-6.3260781712, 2.1409478118],
 [-6.4485114041, 1.8347010002],
 [-6.5486840492, 1.5722037331],
 [-6.6599869882, 1.3242896474],
 [-6.7267687516, 1.0326260173],
 [-6.8158111028, 0.6972128426],
 [-6.8937231601, 0.3909660310],
 [-6.9605049235, 0.0847192194],
 [-7.0272866869, -0.2069444108],
 [-7.0829381564, -0.4402753149],
 [-7.1163290381, -0.6590230375],
 [-7.1608502137, -0.9215203046],
 [-7.1719805076, -1.2423502978],
 [-7.1719805076, -1.5194307464],
 [-7.1719805076, -1.7673448320],
 [-7.1719805076, -2.0006757361],
 [-7.1385896259, -2.3069225478],
 [-7.0940684503, -2.5256702704],
 [-7.0272866869, -2.7590011745],
 [-6.9382443357, -2.9923320786],
 [-6.8380716906, -3.2256629827],
 [-6.7267687516, -3.4735770683],
 [-6.5820749309, -3.7506575170],
 [-6.4383220670, -4.0024421220],
 [-6.2370358200, -4.2173193252],
 [-6.0478208237, -4.4798165923],
 [-5.8252149456, -4.6985643149],
 [-5.6693908310, -4.8881456745],
 [-5.4801758347, -5.0485606711],
 [-5.2687002506, -5.2235588492],
 [-4.9904429031, -5.4860561163],
 [-4.7233158495, -5.6464711129],
 [-4.4227979142, -5.7485533834],
 [-4.1222799789, -5.8506356540],
 [-3.8774135131, -5.9381347430],
 [-3.5991561655, -6.0110506506],
 [-3.3097685241, -6.0985497396],
 [-3.0315111766, -6.1714656471],
 [-2.7532538291, -6.2297983732],
 [-2.5195176572, -6.2735479177],
 [-2.2078694280, -6.3756301882],
 [-1.9296120805, -6.4339629143],
 [-1.6179638512, -6.5068788218],
 [-1.2729247403, -6.5797947293],
 [-0.9278856294, -6.6381274554],
 [-0.5605859307, -6.6964601814],
 [-0.2489377015, -6.7256265444],
 [0.0293196460, -6.7547929074],
 [0.3187072875, -6.7402097259],
 [0.5524434594, -6.7110433629],
 [0.8307008069, -6.6527106369],
 [1.1312187422, -6.5652115478],
 [1.4873881470, -6.4631292773],
 [1.8212969640, -6.3464638252],
 [2.1106846054, -6.2443815547],
 [2.3221601896, -6.0839665581],
 [2.5113751859, -5.9527179245],
 [2.7388075590, -5.7486460210],
 [2.9788475297, -5.5735552053],
 [3.2014534077, -5.4423065718],
 [3.4463198735, -5.2673083937],
 [3.6577954576, -5.0485606711],
 [3.8247498661, -4.9027288560],
 [3.9137922173, -4.7131474964],
 [4.0139648624, -4.5235661368],
 [4.0473557441, -4.3048184142],
 [4.0250951563, -4.0714875101],
 [3.9917042746, -3.8964893320],
 [3.9026619234, -3.6048257019],
 [3.7802286905, -3.4298275238],
 [3.6355348698, -3.2694125272],
 [3.4463198735, -3.1673302567],
 [3.2348442894, -3.1089975307],
 [2.9899778236, -3.0506648046],
 [2.6894598883, -3.0069152601],
 [2.3889419530, -2.9923320786],
 [2.0788675550, -3.0127664800],
 [1.7792074680, -3.0440880060],
 [1.4792194960, -3.0721099380],
 [1.1791080240, -3.0987885000],
 [0.8789686859, -3.1251519920],
 [0.5788044035, -3.1512299780],
 [0.2785599455, -3.1763654950],
 [-0.0218999703, -3.1987534760],
 [-0.3227941990, -3.2139999870],
 [-0.6240110397, -3.2119524480],
 [-0.9241745472, -3.1869269610],
 [-1.2223140000, -3.1434589620],
 [-1.5215114950, -3.1080909970],
 [-1.8216240410, -3.0814670320],
 [-2.1221934560, -3.0606554750],
 [-2.3587391628, -3.0122153151],
 [-2.6710152198, -2.9901478135],
 [-2.9123194456, -2.9460128105],
 [-3.2104011363, -2.8356753028],
 [-3.5510659257, -2.7474052967],
 [-3.8491476165, -2.6150002875],
 [-4.0904518423, -2.4605277768],
 [-4.3033673357, -2.3060552661],
 [-4.4169222655, -2.1295152538],
 [-4.5162828290, -2.0191777462],
 [-4.5730602939, -1.8205702324],
 [-4.5872546602, -1.6219627186],
 [-4.5872546602, -1.4233552048],
 [-4.5446715615, -1.1806126880],
 [-4.4453109979, -0.9378701711],
 [-4.3175617019, -0.7171951558],
 [-4.1330349410, -0.4965201405],
 [-3.9768969125, -0.3420476298],
 [-3.7923701516, -0.2317101221],
 [-3.5510659257, -0.1434401160],
 [-3.2245955026, -0.0331026083],
 [-2.9123194456, -0.0110351068],
 [-2.5858490224, -0.0331026083],
 [-2.2735729655, -0.0551701099],
 [-1.9754912747, -0.0551701099],
 [-1.6774095840, -0.1213726145],
 [-1.3793278933, -0.1655076175],
 [-1.0670518363, -0.2317101221],
 [-0.8257476105, -0.2758451252],
 [-0.5560546522, -0.3199801282],
 [-0.2153898628, -0.3641151313],
 [0.0684974617, -0.3861826328],
 [0.3854890509, -0.4548584964],
 [0.6788552093, -0.4523851374]]

class DraggableScatter():

    epsilon = 5

    def __init__(self, scatter):

        self.scatter = scatter
        self._ind = None
        self.ax = scatter.axes
        self.canvas = self.ax.figure.canvas
        self.canvas.mpl_connect('button_press_event', self.button_press_callback)
        self.canvas.mpl_connect('button_release_event', self.button_release_callback)
        self.canvas.mpl_connect('motion_notify_event', self.motion_notify_callback)
        self.canvas.mpl_connect('key_press_event', self.on_key_press)
        plt.show()


    def get_ind_under_point(self, event):   
        xy = np.asarray(self.scatter.get_offsets())
        xyt = self.ax.transData.transform(xy)
        xt, yt = xyt[:, 0], xyt[:, 1]

        d = np.sqrt((xt - event.x)**2 + (yt - event.y)**2)
        ind = d.argmin()

        if d[ind] >= self.epsilon:
            ind = None

        return ind

    def button_press_callback(self, event):
        if event.inaxes is None:
            return
        if event.button != 1:
            return
        self._ind = self.get_ind_under_point(event)

    def button_release_callback(self, event):
        if event.button != 1:
            return
        self._ind = None

    def motion_notify_callback(self, event):
        if self._ind is None:
            return
        if event.inaxes is None:
            return
        if event.button != 1:
            return
        x, y = event.xdata, event.ydata
        xy = np.asarray(self.scatter.get_offsets())
        xy[self._ind] = np.array([x, y])        
        self.scatter.set_offsets(xy)
        self.canvas.draw_idle()
        # print(self.scatter.get_offsets())
		
    def on_key_press(self, event):
        if event.key == 'r':
            fileName = input('Enter name of file:')
            with open(fileName+'.txt', 'w') as f:
                f.writelines(np.array2string(self.scatter.get_offsets(), formatter={'float': lambda x: f'{x:.10f}'}, separator=', '))
                print("Waypoints Saved")
        elif event.key == 'd':
            ind = self.get_ind_under_point(event)
            if ind is not None:
                xy = np.asarray(self.scatter.get_offsets())
                xy = np.delete(xy, ind, axis=0)  
                self.scatter.set_offsets(xy)
                self.canvas.draw_idle()

# PLot
waypointsXInner =[]
waypointsYInner =[]

waypointsXCenter =[]
waypointsYCenter =[]

waypointsXOuter =[]
waypointsYOuter =[]

routeX =[]
routeY =[]
data = np.load('2022_march_pro.npy')
for points in data:
	for index, point in enumerate(points):
		if index == 0 :
			waypointsXCenter.append(point)
		elif index == 1 :
			waypointsYCenter.append(point)
		elif index == 2 :
			waypointsXInner.append(point)
		elif index == 3 :
			waypointsYInner.append(point)
		elif index == 4 :
			waypointsXOuter.append(point)
		elif index == 5 :
			waypointsYOuter.append(point)
			
for eachData in currentRoute:
	routeX.append(eachData[0])
	routeY.append(eachData[1])
	
fig, ax = plt.subplots()
scatter = ax.scatter(routeX, routeY, color = 'blue', s=11)
plt.plot(waypointsXInner,waypointsYInner, color ='black')
plt.plot(waypointsXCenter,waypointsYCenter, color='orange')
plt.plot(waypointsXOuter,waypointsYOuter, color ='black')

DraggableScatter(scatter)